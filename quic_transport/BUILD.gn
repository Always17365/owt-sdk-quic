# Copyright (C) <2020> Intel Corporation
#
# SPDX-License-Identifier: Apache-2.0

import("//testing/test.gni")

source_set("owt_deps_quic") {
  # This target is similar as //src/third_party/openscreen/src/third_party/chromium_quic/BUILD.gn.
  sources = [
    "//net/quic/platform/impl/quic_default_proof_providers_impl.cc",
    "//net/quic/platform/impl/quic_default_proof_providers_impl.h",
    "//net/third_party/quiche/src/quic/core/chlo_extractor.cc",
    "//net/third_party/quiche/src/quic/core/chlo_extractor.h",
    "//net/third_party/quiche/src/quic/core/quic_buffered_packet_store.cc",
    "//net/third_party/quiche/src/quic/core/quic_buffered_packet_store.h",
    "//net/third_party/quiche/src/quic/core/quic_dispatcher.cc",
    "//net/third_party/quiche/src/quic/core/quic_dispatcher.h",
    "//net/third_party/quiche/src/quic/core/quic_time_wait_list_manager.cc",
    "//net/third_party/quiche/src/quic/core/quic_time_wait_list_manager.h",
    "//net/third_party/quiche/src/quic/core/tls_chlo_extractor.cc",
    "//net/third_party/quiche/src/quic/core/tls_chlo_extractor.h",
    "//net/third_party/quiche/src/quic/tools/quic_transport_simple_server_dispatcher.cc",
    "//net/third_party/quiche/src/quic/tools/quic_transport_simple_server_dispatcher.h",
    "//net/third_party/quiche/src/quic/tools/quic_transport_simple_server_session.cc",
    "//net/third_party/quiche/src/quic/tools/quic_transport_simple_server_session.h",
    "//net/third_party/quiche/src/quic/tools/simple_ticket_crypter.cc",
    "//net/third_party/quiche/src/quic/tools/simple_ticket_crypter.h",
    "//net/tools/quic/quic_simple_server_packet_writer.cc",
    "//net/tools/quic/quic_simple_server_packet_writer.h",
    "//net/tools/quic/quic_simple_server_socket.cc",
    "//net/tools/quic/quic_simple_server_socket.h",
  ]
  include_dirs = [ "//" ]
  deps = [
    "//base",
    "//third_party/boringssl",
    "//url",
  ]
  configs += [ "//third_party/protobuf:protobuf_config" ]
}

shared_library("owt_quic_transport") {
  deps = [
    ":owt_deps_quic",
    "//net",
    "//third_party/boringssl",
  ]
  sources = [
    "api/owt/quic/quic_definitions.h",
    "api/owt/quic/quic_transport_client_interface.h",
    "api/owt/quic/quic_transport_factory.h",
    "api/owt/quic/quic_transport_server_interface.h",
    "impl/quic_transport_factory_impl.cc",
    "impl/quic_transport_factory_impl.h",
    "impl/quic_transport_owt_client_impl.cc",
    "impl/quic_transport_owt_client_impl.h",
    "impl/quic_transport_owt_server_dispatcher.cc",
    "impl/quic_transport_owt_server_dispatcher.h",
    "impl/quic_transport_owt_server_impl.cc",
    "impl/quic_transport_owt_server_impl.h",
    "impl/quic_transport_owt_server_session.cc",
    "impl/quic_transport_owt_server_session.h",
    "impl/quic_transport_stream_impl.cc",
    "impl/quic_transport_stream_impl.h",
  ]
  include_dirs = [
    "./",
    "api",
  ]

  defines = [ "OWT_QUIC_LIBRARY_IMPL" ]

  #complete_static_lib = true
}

test("owt_quic_transport_tests") {
  testonly = true
  sources = [ "impl/quic_transport_owt_end_to_end_test.cc" ]
  configs += [ "//build/config:precompiled_headers" ]
  deps = [
    ":owt_quic_transport",
    "//testing/gmock",
    "//testing/gtest",
  ]
}
